<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ReadBrain â€” GAMSAT ì˜¤ë‹µë…¸íŠ¸</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;700;800&family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#080c14;--layer1:#0d1422;--layer2:#131d2e;--layer3:#1a2540;
  --border:rgba(255,255,255,0.07);--border2:rgba(255,255,255,0.12);
  --mint:#2de4b6;--mint-dim:rgba(45,228,182,0.12);
  --gold:#f5c842;--gold-dim:rgba(245,200,66,0.12);
  --red:#ff4d6a;--red-dim:rgba(255,77,106,0.12);
  --purple:#a855f7;--purple-dim:rgba(168,85,247,0.12);
  --blue:#38bdf8;--blue-dim:rgba(56,189,248,0.12);
  --text:#dde6f5;--text2:#7a8aaa;--text3:#455170;
  --mono:'JetBrains Mono',monospace;--sans:'Noto Sans KR',sans-serif;
  --display:'Syne',sans-serif;--r:14px;--r-lg:20px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100dvh;max-width:480px;margin:0 auto;overflow-x:hidden;position:relative;}
body::before{content:'';position:fixed;inset:0;
  background-image:linear-gradient(rgba(45,228,182,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(45,228,182,0.02) 1px,transparent 1px);
  background-size:32px 32px;pointer-events:none;z-index:0;}
.app{position:relative;z-index:1;display:flex;flex-direction:column;min-height:100dvh;}

/* â”€â”€ HEADER â”€â”€ */
header{padding:14px 20px 10px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:var(--layer1);position:sticky;top:0;z-index:100;}
.logo{font-family:var(--display);font-weight:800;font-size:21px;letter-spacing:-0.5px;color:var(--text);}
.logo span{color:var(--mint);}
.logo-sub{font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--text3);margin-top:1px;text-transform:uppercase;}
.streak-badge{font-family:var(--mono);font-size:11px;color:var(--gold);background:var(--gold-dim);border:1px solid rgba(245,200,66,0.2);padding:3px 10px;border-radius:30px;cursor:pointer;}

/* â”€â”€ NAV (íƒ­ 4ê°œ) â”€â”€ */
nav{display:flex;background:var(--layer1);border-bottom:1px solid var(--border);padding:0 4px;position:sticky;top:53px;z-index:100;}
.tab{flex:1;padding:10px 2px;background:none;border:none;color:var(--text3);font-size:10px;font-family:var(--sans);font-weight:500;cursor:pointer;transition:color .2s;display:flex;flex-direction:column;align-items:center;gap:2px;position:relative;}
.tab .tab-icon{font-size:15px;}
.tab::after{content:'';position:absolute;bottom:0;left:15%;right:15%;height:2px;border-radius:2px 2px 0 0;background:var(--mint);opacity:0;transition:opacity .2s;}
.tab.active{color:var(--mint);}
.tab.active::after{opacity:1;}
.tab-badge{position:absolute;top:6px;right:4px;background:var(--red);color:#fff;font-size:9px;font-weight:700;font-family:var(--mono);padding:1px 4px;border-radius:10px;min-width:15px;text-align:center;display:none;}
.tab-badge.show{display:block;}

/* â”€â”€ SECTIONS â”€â”€ */
section{display:none;flex:1;overflow-y:auto;}
section.active{display:block;}
.view-inner{padding:16px;display:flex;flex-direction:column;gap:12px;}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--layer2);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;}
.card-label{font-family:var(--mono);font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--text3);margin-bottom:12px;}

/* â”€â”€ STATS â”€â”€ */
.stats-row{display:flex;gap:8px;}
.stat-box{flex:1;background:var(--layer2);border:1px solid var(--border);border-radius:var(--r);padding:12px 8px;text-align:center;}
.stat-num{font-family:var(--display);font-weight:700;font-size:28px;color:var(--mint);line-height:1;}
.stat-num.gold{color:var(--gold);}
.stat-num.red{color:var(--red);}
.stat-label{font-family:var(--mono);font-size:9px;letter-spacing:1px;color:var(--text3);margin-top:4px;text-transform:uppercase;}

/* â”€â”€ TODAY LIST â”€â”€ */
.today-empty{text-align:center;padding:32px 20px;}
.today-empty .ei{font-size:42px;margin-bottom:12px;}
.today-empty p{color:var(--text2);font-size:13px;line-height:1.8;}
.today-empty strong{color:var(--mint);}
.quiz-row{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border);cursor:pointer;gap:10px;transition:opacity .15s;}
.quiz-row:last-child{border-bottom:none;}
.quiz-row:active{opacity:.6;}
.qr-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.qr-info{flex:1;min-width:0;}
.qr-type{font-family:var(--mono);font-size:9px;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:2px;}
.qr-q{font-size:12px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.qr-cycle{font-family:var(--mono);font-size:9px;padding:2px 7px;border-radius:20px;background:var(--gold-dim);color:var(--gold);border:1px solid rgba(245,200,66,0.2);flex-shrink:0;}
.start-btn{width:100%;padding:15px;background:var(--mint);color:#080c14;border:none;border-radius:var(--r);font-family:var(--display);font-weight:700;font-size:16px;letter-spacing:1px;cursor:pointer;transition:transform .1s,opacity .1s;}
.start-btn:active{transform:scale(.98);opacity:.9;}
.start-btn:disabled{opacity:.35;cursor:not-allowed;}
.data-status{font-family:var(--mono);font-size:10px;padding:8px 12px;border-radius:8px;display:flex;align-items:center;gap:6px;}
.data-status.ok{color:var(--mint);background:var(--mint-dim);border:1px solid rgba(45,228,182,0.2);}
.data-status.err{color:var(--gold);background:var(--gold-dim);border:1px solid rgba(245,200,66,0.2);}
.data-status.loading{color:var(--text3);background:var(--layer3);border:1px solid var(--border);}

/* â”€â”€ QUIZ OVERLAY â”€â”€ */
#quiz-overlay{display:none;position:fixed;inset:0;z-index:200;background:var(--bg);flex-direction:column;overflow:hidden;}
#quiz-overlay.open{display:flex;}
.qo-header{padding:12px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);flex-shrink:0;}
.qo-back{background:none;border:1px solid var(--border2);color:var(--text2);border-radius:8px;padding:6px 12px;font-size:12px;font-family:var(--sans);cursor:pointer;}
.qo-counter{font-family:var(--mono);font-size:12px;color:var(--text2);}
.qo-counter strong{color:var(--mint);}
.qo-src{font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:1px;margin-top:2px;}
.qo-progress{height:3px;background:var(--layer3);flex-shrink:0;}
.qo-progress-fill{height:100%;background:linear-gradient(90deg,var(--mint),var(--gold));transition:width .4s ease;width:0;}
.qo-body{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:12px;}

/* â”€â”€ FLASHCARD â”€â”€ */
.fc-scene{perspective:1200px;}
.fc-card{position:relative;width:100%;transform-style:preserve-3d;transition:transform .55s cubic-bezier(.4,0,.2,1);border-radius:var(--r-lg);}
.fc-card.flipped{transform:rotateY(180deg);}
.fc-front{backface-visibility:hidden;border-radius:var(--r-lg);padding:20px;background:var(--layer2);border:1px solid var(--border2);}
.fc-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:var(--r-lg);padding:20px;background:linear-gradient(145deg,var(--layer2),#0d1e2a);border:1px solid rgba(45,228,182,0.25);transform:rotateY(180deg);display:flex;flex-direction:column;overflow-y:auto;}
.fc-badge{display:inline-flex;align-items:center;gap:6px;font-family:var(--mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;padding:4px 10px;border-radius:20px;margin-bottom:12px;align-self:flex-start;}
.fc-q{font-size:14px;line-height:1.85;color:var(--text);}
.fc-q em{color:var(--mint);font-style:normal;font-weight:700;background:var(--mint-dim);padding:1px 5px;border-radius:4px;}
.fc-q strong{color:var(--gold);font-weight:700;}
.fc-tap{margin-top:14px;text-align:center;font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:1px;animation:breathe 2.5s ease-in-out infinite;}
.fc-tap.hidden{display:none;}
@keyframes breathe{0%,100%{opacity:.3}50%{opacity:.9}}

/* â”€â”€ MCQ OPTIONS â”€â”€ */
.mcq-opts{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
.mcq-opt{display:flex;align-items:flex-start;gap:10px;padding:11px 13px;border-radius:10px;background:var(--layer3);border:1.5px solid var(--border2);cursor:pointer;transition:all .18s;font-size:13px;line-height:1.6;color:var(--text2);text-align:left;width:100%;font-family:var(--sans);}
.mcq-opt.selected{border-color:var(--mint);background:var(--mint-dim);color:var(--text);}
.mcq-opt.correct{border-color:var(--mint);background:rgba(45,228,182,0.2);color:var(--mint);font-weight:700;}
.mcq-opt.wrong{border-color:var(--red);background:var(--red-dim);color:var(--red);}
.mcq-num{font-family:var(--mono);font-size:12px;font-weight:700;flex-shrink:0;min-width:18px;margin-top:2px;}

/* â”€â”€ CARD BACK â”€â”€ */
.fc-ans-label{font-family:var(--mono);font-size:9px;letter-spacing:2.5px;color:var(--mint);text-transform:uppercase;margin-bottom:8px;}
.fc-ans{font-size:17px;font-weight:700;color:var(--mint);line-height:1.5;margin-bottom:10px;}
.fc-divider{height:1px;background:var(--border);margin:8px 0;}
.fc-exp-label{font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--text3);text-transform:uppercase;margin-bottom:7px;}
.fc-exp{font-size:13px;color:var(--text2);line-height:1.8;}
.fc-action{margin-top:10px;font-family:var(--mono);font-size:10px;color:var(--gold);letter-spacing:0.5px;padding:8px 12px;background:var(--gold-dim);border-radius:8px;border-left:2px solid var(--gold);}

/* â”€â”€ BOTTOM BUTTONS â”€â”€ */
.btn-row{display:flex;gap:10px;}
.btn-o{flex:1;padding:15px;border-radius:var(--r);border:1.5px solid rgba(45,228,182,0.35);font-size:18px;font-weight:700;cursor:pointer;background:var(--mint-dim);color:var(--mint);transition:all .15s;font-family:var(--mono);}
.btn-o:active{background:var(--mint);color:#080c14;}
.btn-x{flex:1;padding:15px;border-radius:var(--r);border:1.5px solid rgba(255,77,106,0.35);font-size:18px;font-weight:700;cursor:pointer;background:var(--red-dim);color:var(--red);transition:all .15s;font-family:var(--mono);}
.btn-x:active{background:var(--red);color:#fff;}
.ox-note{text-align:center;font-family:var(--mono);font-size:10px;color:var(--text3);}
.action-btn{width:100%;padding:14px;border-radius:var(--r);font-family:var(--mono);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;display:none;}
.action-btn.show{display:block;}
.btn-confirm{background:var(--mint-dim);border:1.5px solid rgba(45,228,182,0.4);color:var(--mint);}
.btn-confirm:active{background:var(--mint);color:#080c14;}
.btn-next{background:var(--layer3);border:1.5px solid var(--border2);color:var(--text);font-family:var(--display);font-size:15px;letter-spacing:1px;}
.btn-next:active{background:var(--layer2);}
.ox-wrap{display:none;flex-direction:column;gap:10px;}
.ox-wrap.show{display:flex;}

/* â”€â”€ ADD FORM â”€â”€ */
.step-select{display:flex;flex-direction:column;gap:8px;}
.step-opt{display:flex;align-items:flex-start;gap:12px;padding:12px 13px;border-radius:var(--r);background:var(--layer3);border:1.5px solid var(--border);cursor:pointer;transition:all .2s;}
.step-opt.selected{border-color:var(--mint);background:var(--mint-dim);}
.step-n{font-family:'Bebas Neue',cursive;font-size:26px;color:var(--mint);line-height:1;flex-shrink:0;width:20px;}
.step-name{font-size:12px;font-weight:700;color:var(--text);margin-bottom:2px;}
.step-desc{font-size:11px;color:var(--text2);line-height:1.5;}
.form-grp{display:flex;flex-direction:column;gap:7px;}
.form-lbl{font-family:var(--mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);}
input[type=text],textarea{background:var(--layer3);border:1px solid var(--border2);color:var(--text);border-radius:var(--r);padding:11px 13px;font-size:14px;font-family:var(--sans);transition:border-color .2s;width:100%;resize:vertical;}
input[type=text]:focus,textarea:focus{outline:none;border-color:var(--mint);}
::placeholder{color:var(--text3);}
.hint-box{background:var(--mint-dim);border:1px solid rgba(45,228,182,0.2);border-radius:var(--r);padding:11px 13px;font-size:12px;color:var(--text2);line-height:1.7;}
.hint-box strong{color:var(--mint);}
.btn-add{width:100%;padding:16px;background:linear-gradient(135deg,var(--mint),#1ec4a0);color:#080c14;border:none;border-radius:var(--r);font-family:var(--display);font-weight:700;font-size:16px;letter-spacing:1px;cursor:pointer;}
.btn-add:active{opacity:.88;}

/* â”€â”€ ALL / BROWSE LIST â”€â”€ */
.aqi{display:flex;align-items:flex-start;gap:12px;padding:13px 0;border-bottom:1px solid var(--border);}
.aqi:last-child{border-bottom:none;}
.aqi-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;margin-top:4px;}
.aqi-info{flex:1;min-width:0;}
.aqi-type{font-family:var(--mono);font-size:9px;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:3px;display:flex;align-items:center;flex-wrap:wrap;gap:4px;}
.aqi-q{font-size:13px;color:var(--text);line-height:1.5;margin-bottom:4px;}
.aqi-meta{font-family:var(--mono);font-size:10px;color:var(--text3);}
.tag{font-family:var(--mono);font-size:9px;padding:1px 6px;border-radius:10px;}
.tag-src{color:var(--purple);background:var(--purple-dim);border:1px solid rgba(168,85,247,0.3);}
.tag-mcq{color:var(--mint);background:var(--mint-dim);border:1px solid rgba(45,228,182,0.3);}
.tag-done{color:var(--text3);background:var(--layer3);border:1px solid var(--border);}
.aqi-actions{display:flex;flex-direction:column;gap:6px;flex-shrink:0;align-self:center;}
.aqi-del{background:none;border:1px solid var(--border);color:var(--text3);border-radius:6px;padding:4px 8px;font-size:11px;cursor:pointer;transition:all .2s;}
.aqi-del:active{border-color:var(--red);color:var(--red);}
.aqi-reset{background:none;border:1px solid rgba(56,189,248,0.3);color:var(--blue);border-radius:6px;padding:4px 8px;font-size:11px;cursor:pointer;transition:all .2s;}
.aqi-reset:active{background:var(--blue-dim);}

/* â”€â”€ BROWSE FILTER â”€â”€ */
.filter-bar{display:flex;gap:6px;flex-wrap:wrap;}
.filter-btn{font-family:var(--mono);font-size:10px;padding:5px 12px;border-radius:20px;border:1px solid var(--border2);background:var(--layer3);color:var(--text3);cursor:pointer;transition:all .18s;}
.filter-btn.active{border-color:var(--mint);background:var(--mint-dim);color:var(--mint);}

/* â”€â”€ DETAIL MODAL â”€â”€ */
#detailModal{display:none;position:fixed;inset:0;z-index:300;background:rgba(8,12,20,0.92);align-items:flex-end;}
#detailModal.open{display:flex;}
.detail-sheet{background:var(--layer2);border:1px solid var(--border2);border-radius:20px 20px 0 0;padding:20px;width:100%;max-height:85vh;overflow-y:auto;animation:slideUp .3s ease;}
@keyframes slideUp{from{transform:translateY(60px);opacity:0}to{transform:translateY(0);opacity:1}}
.detail-close{width:100%;padding:12px;background:var(--layer3);border:1px solid var(--border);color:var(--text2);border-radius:var(--r);font-family:var(--sans);font-size:13px;cursor:pointer;margin-top:16px;}
.detail-close:active{background:var(--layer2);}
.detail-section{margin-bottom:14px;}
.detail-label{font-family:var(--mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:6px;}
.detail-content{font-size:13px;color:var(--text);line-height:1.8;background:var(--layer3);padding:12px;border-radius:10px;}
.detail-content em{color:var(--mint);font-style:normal;background:var(--mint-dim);padding:1px 4px;border-radius:4px;}
.detail-content strong{color:var(--gold);}
.detail-ans{font-size:16px;font-weight:700;color:var(--mint);}
.detail-exp{font-size:13px;color:var(--text2);line-height:1.8;}
.detail-action-box{font-family:var(--mono);font-size:10px;color:var(--gold);padding:10px 12px;background:var(--gold-dim);border-radius:8px;border-left:2px solid var(--gold);}

/* â”€â”€ SETTINGS â”€â”€ */
.settings-section{display:flex;flex-direction:column;gap:8px;}
.setting-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--layer2);border:1px solid var(--border);border-radius:var(--r);cursor:pointer;transition:border-color .2s;}
.setting-row:active{border-color:var(--border2);}
.setting-row.danger:active{border-color:var(--red);}
.setting-icon{font-size:18px;margin-right:10px;}
.setting-info{flex:1;}
.setting-title{font-size:13px;font-weight:500;color:var(--text);margin-bottom:2px;}
.setting-desc{font-size:11px;color:var(--text3);}
.setting-arrow{color:var(--text3);font-size:14px;}
.setting-row.danger .setting-title{color:var(--red);}
.setting-row.danger .setting-arrow{color:var(--red);}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(60px);background:var(--layer2);border:1px solid var(--border2);color:var(--text);padding:10px 20px;border-radius:30px;font-size:13px;font-family:var(--mono);white-space:nowrap;transition:transform .3s,opacity .3s;opacity:0;z-index:9999;}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
.toast.ok{border-color:var(--mint);color:var(--mint);}
.toast.ng{border-color:var(--red);color:var(--red);}

/* TYPE COLORS */
.t-indexing{color:#ff8c42;}.t-targeting{color:var(--mint);}.t-paraphrase{color:var(--purple);}.t-logic{color:var(--gold);}
.bg-indexing{background:rgba(255,140,66,0.15);}.bg-targeting{background:var(--mint-dim);}.bg-paraphrase{background:var(--purple-dim);}.bg-logic{background:var(--gold-dim);}
.d-indexing{background:#ff8c42;}.d-targeting{background:var(--mint);}.d-paraphrase{background:var(--purple);}.d-logic{background:var(--gold);}

::-webkit-scrollbar{width:3px;}
::-webkit-scrollbar-thumb{background:var(--layer3);border-radius:3px;}
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <div class="logo">Read<span>Brain</span></div>
      <div class="logo-sub">GAMSAT Â· Active Recall</div>
    </div>
    <div><div class="streak-badge" id="streakBadge" onclick="switchTab('settings')">ğŸ”¥ 0 ì—°ì†</div></div>
  </header>

  <nav>
    <button class="tab active" data-tab="today" onclick="switchTab('today')">
      <span class="tab-icon">ğŸ“‹</span>ì˜¤ëŠ˜
      <span class="tab-badge" id="badge-today">0</span>
    </button>
    <button class="tab" data-tab="browse" onclick="switchTab('browse')">
      <span class="tab-icon">ğŸ”</span>ëª©ë¡
    </button>
    <button class="tab" data-tab="add" onclick="switchTab('add')">
      <span class="tab-icon">ï¼‹</span>ì¶”ê°€
    </button>
    <button class="tab" data-tab="settings" onclick="switchTab('settings')">
      <span class="tab-icon">âš™</span>ì„¤ì •
    </button>
  </nav>

  <!-- â•â•â• TODAY â•â•â• -->
  <section id="sec-today" class="active">
    <div class="view-inner">
      <div id="dataStatus" class="data-status loading">â³ data.json ë¡œë”© ì¤‘...</div>
      <div class="stats-row">
        <div class="stat-box"><div class="stat-num" id="statTotal">0</div><div class="stat-label">ì´ í€´ì¦ˆ</div></div>
        <div class="stat-box"><div class="stat-num gold" id="statDue">0</div><div class="stat-label">ì˜¤ëŠ˜ ë³µìŠµ</div></div>
        <div class="stat-box"><div class="stat-num red" id="statStreak">0</div><div class="stat-label">ì—°ì† ì •ë‹µ</div></div>
      </div>
      <button class="start-btn" id="startBtn" onclick="startQuiz()" disabled>â–¶ ë³µìŠµ ì‹œì‘í•˜ê¸°</button>
      <div class="card">
        <div class="card-label">ì˜¤ëŠ˜ í’€ì–´ì•¼ í•  í€´ì¦ˆ</div>
        <div id="todayList"></div>
      </div>
    </div>
  </section>

  <!-- â•â•â• BROWSE (ëª©ë¡ + ìƒì„¸) â•â•â• -->
  <section id="sec-browse">
    <div class="view-inner">
      <div class="card">
        <div class="card-label">í€´ì¦ˆ ëª©ë¡ ì¡°íšŒ</div>
        <div class="filter-bar" id="filterBar">
          <button class="filter-btn active" onclick="setFilter('all',this)">ì „ì²´</button>
          <button class="filter-btn" onclick="setFilter('indexing',this)">ì¸ë±ì‹±</button>
          <button class="filter-btn" onclick="setFilter('targeting',this)">íƒ€ê²ŸíŒ…</button>
          <button class="filter-btn" onclick="setFilter('paraphrase',this)">íŒ¨ëŸ¬í”„ë ˆì´ì¦ˆ</button>
          <button class="filter-btn" onclick="setFilter('logic',this)">ë…¼ë¦¬</button>
          <button class="filter-btn" onclick="setFilter('mcq',this)">MCQ</button>
          <button class="filter-btn" onclick="setFilter('due',this)">ë³µìŠµ ì˜ˆì •</button>
        </div>
      </div>
      <div class="card">
        <div id="browseList"></div>
      </div>
    </div>
  </section>

  <!-- â•â•â• ADD â•â•â• -->
  <section id="sec-add">
    <div class="view-inner">
      <div class="card">
        <div class="card-label">Step 1 â€” ì˜¤ë¥˜ ìœ í˜• ì„ íƒ</div>
        <div class="step-select">
          <div class="step-opt selected" onclick="selectStep(this,'indexing')">
            <div class="step-n t-indexing">1</div>
            <div><div class="step-name">ì¸ë±ì‹± ì˜¤ë¥˜</div><div class="step-desc">ì˜ˆì‹œÂ·ì„¸ë¶€ì‚¬í•­ì„ ê¸€ì˜ ì£¼ì œë¡œ ì°©ê°</div></div>
          </div>
          <div class="step-opt" onclick="selectStep(this,'targeting')">
            <div class="step-n t-targeting">2</div>
            <div><div class="step-name">íƒ€ê²ŸíŒ… ì˜¤ë¥˜</div><div class="step-desc">ì§ˆë¬¸ í‚¤ì›Œë“œê°€ ë³¸ë¬¸ì— ì—†ì„ ë•Œ ìƒìœ„ê°œë… íƒìƒ‰ ì‹¤íŒ¨</div></div>
          </div>
          <div class="step-opt" onclick="selectStep(this,'paraphrase')">
            <div class="step-n t-paraphrase">3</div>
            <div><div class="step-name">íŒ¨ëŸ¬í”„ë ˆì´ì§• ì˜¤ë¥˜</div><div class="step-desc">ë³¸ë¬¸Â·ì„ ì§€ í‘œí˜„ì´ ê°™ì€ ì˜ë¯¸ì¸ë° ì—°ê²° ì‹¤íŒ¨</div></div>
          </div>
          <div class="step-opt" onclick="selectStep(this,'logic')">
            <div class="step-n t-logic">4</div>
            <div><div class="step-name">ì„ ì§€ ë…¼ë¦¬ ì°©ì˜¤</div><div class="step-desc">ê·¹ë‹¨ì–´(always/every)Â·ìˆ˜ëŸ‰Â·ëŒ€ìƒ ë¹„êµ ì˜¤ë¥˜</div></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-label">Step 2 â€” ì˜¤ë‹µ ì •ë³´ ì…ë ¥</div>
        <div id="hintBox" class="hint-box" style="margin-bottom:14px;"></div>
        <div id="formFields" style="display:flex;flex-direction:column;gap:12px;"></div>
      </div>
      <div class="card">
        <div class="card-label">Step 3 â€” í€´ì¦ˆ ë¯¸ë¦¬ë³´ê¸°</div>
        <div id="previewBox" style="font-size:13px;color:var(--text2);line-height:1.8;">ì˜¤ë¥˜ ìœ í˜• ì„ íƒ í›„ ì…ë ¥í•˜ë©´ í€´ì¦ˆê°€ ìƒì„±ë©ë‹ˆë‹¤.</div>
      </div>
      <button class="btn-add" onclick="addQuiz()">í€´ì¦ˆ ì €ì¥í•˜ê¸°</button>
    </div>
  </section>

  <!-- â•â•â• SETTINGS â•â•â• -->
  <section id="sec-settings">
    <div class="view-inner">
      <div class="card">
        <div class="card-label">í•™ìŠµ ì •ë³´</div>
        <div class="stats-row">
          <div class="stat-box"><div class="stat-num" id="s2statTotal">0</div><div class="stat-label">ì´ í€´ì¦ˆ</div></div>
          <div class="stat-box"><div class="stat-num gold" id="s2statStreak">0</div><div class="stat-label">ìµœê³  ì—°ì†</div></div>
          <div class="stat-box"><div class="stat-num red" id="s2statDone">0</div><div class="stat-label">ì™„ë£Œ</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-label">ê´€ë¦¬</div>
        <div class="settings-section">
          <div class="setting-row" onclick="resetAllProgress()">
            <span class="setting-icon">ğŸ”„</span>
            <div class="setting-info">
              <div class="setting-title">ì „ì²´ ë³µìŠµ ì´ˆê¸°í™”</div>
              <div class="setting-desc">ëª¨ë“  í€´ì¦ˆë¥¼ ì˜¤ëŠ˜ ë³µìŠµ ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤</div>
            </div>
            <span class="setting-arrow">â€º</span>
          </div>
          <div class="setting-row" onclick="resetStreakOnly()">
            <span class="setting-icon">ğŸ”¥</span>
            <div class="setting-info">
              <div class="setting-title">ì—°ì† ê¸°ë¡ ì´ˆê¸°í™”</div>
              <div class="setting-desc">ì •ë‹µ ì—°ì† ì¹´ìš´íŠ¸ë§Œ 0ìœ¼ë¡œ ë¦¬ì…‹</div>
            </div>
            <span class="setting-arrow">â€º</span>
          </div>
          <div class="setting-row danger" onclick="resetAllData()">
            <span class="setting-icon">ğŸ—‘</span>
            <div class="setting-info">
              <div class="setting-title">ì „ì²´ ë°ì´í„° ì‚­ì œ</div>
              <div class="setting-desc">ëª¨ë“  í€´ì¦ˆÂ·ê¸°ë¡ì„ ì™„ì „ ì‚­ì œ (ë³µêµ¬ ë¶ˆê°€)</div>
            </div>
            <span class="setting-arrow">â€º</span>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-label">data.json ì—°ë™</div>
        <div id="dataStatus2" style="font-family:var(--mono);font-size:11px;color:var(--text3);line-height:1.7;">
          data.jsonì„ ê°™ì€ í´ë”ì— ë‘ë©´<br>ì•± ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
        </div>
        <div style="margin-top:10px;">
          <button class="btn-add" style="padding:12px;font-size:13px;" onclick="loadDataJson(true)">â†º data.json ì¬ë¡œë“œ</button>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     QUIZ OVERLAY
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="quiz-overlay">
  <div class="qo-header">
    <button class="qo-back" onclick="closeQuiz()">â† ë‹«ê¸°</button>
    <div style="text-align:right;">
      <div class="qo-counter"><strong id="qoCurrent">1</strong> / <span id="qoTotal">1</span></div>
      <div class="qo-src" id="qoSrc"></div>
    </div>
  </div>
  <div class="qo-progress"><div class="qo-progress-fill" id="qoFill"></div></div>
  <div class="qo-body">
    <div class="fc-scene">
      <div class="fc-card" id="fcCard">
        <div class="fc-front" id="fcFront">
          <div class="fc-badge" id="fcBadge">LOGIC</div>
          <div class="fc-q" id="fcQ">...</div>
          <div class="mcq-opts" id="mcqOpts"></div>
          <div class="fc-tap" id="fcTap">íƒ­í•´ì„œ ì •ë‹µ í™•ì¸ â†’</div>
        </div>
        <div class="fc-back" id="fcBack">
          <div class="fc-ans-label">âœ¦ ì •ë‹µ</div>
          <div class="fc-ans" id="fcAns"></div>
          <div class="fc-divider"></div>
          <div class="fc-exp-label">í•´ì„¤ & ë…¼ë¦¬ ë¶„ì„</div>
          <div class="fc-exp" id="fcExp"></div>
          <div class="fc-action" id="fcAction"></div>
        </div>
      </div>
    </div>
    <button class="action-btn btn-confirm" id="btnConfirm" onclick="confirmMcq()">ì •ë‹µ í™•ì¸í•˜ê¸° â†’</button>
    <button class="action-btn btn-next" id="btnNext" onclick="goNext()">ë‹¤ìŒ â†’</button>
    <div class="ox-wrap" id="oxWrap">
      <div class="btn-row">
        <button class="btn-o" onclick="goNext(true)">â­• ë§ì•˜ì–´ìš”</button>
        <button class="btn-x" onclick="goNext(false)">âŒ í‹€ë ¸ì–´ìš”</button>
      </div>
      <div class="ox-note">ì •ë‹µ í™•ì¸ í›„ ì •ì§í•˜ê²Œ ì²´í¬!</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DETAIL MODAL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="detailModal" onclick="closeDetail(event)">
  <div class="detail-sheet" id="detailSheet">
    <div id="detailContent"></div>
    <button class="detail-close" onclick="closeDetailSheet()">ë‹«ê¸°</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â•â•â•â•â•â•â• STORAGE â•â•â•â•â•â•â• */
const SK='readbrain_v6', STK='readbrain_streak';
const loadQ  = () => { try{return JSON.parse(localStorage.getItem(SK))||[];}catch{return[];} };
const saveQ  = d => localStorage.setItem(SK, JSON.stringify(d));
const loadSt = () => { try{return JSON.parse(localStorage.getItem(STK))||{count:0,best:0,lastDate:''};}catch{return{count:0,best:0,lastDate:''};} };
const saveSt = s => localStorage.setItem(STK, JSON.stringify(s));

/* â•â•â•â•â•â•â• SRS â•â•â•â•â•â•â• */
const IVLS = [1,3,7];
const todayStr = () => new Date().toISOString().split('T')[0];
const addDays  = (s,n) => { const d=new Date(s); d.setDate(d.getDate()+n); return d.toISOString().split('T')[0]; };
const isDue    = q => q.nextReview <= todayStr();

function advanceSRS(q, ok) {
  if (!ok) { q.cycleIdx=0; q.nextReview=addDays(todayStr(),1); return; }
  q.cycleIdx = (q.cycleIdx ?? 0);
  const ni = q.cycleIdx+1;
  if (ni < IVLS.length) { q.cycleIdx=ni; q.nextReview=addDays(todayStr(),IVLS[ni]); }
  else                  { q.cycleIdx=IVLS.length; q.nextReview='9999-12-31'; }
}

/* â•â•â•â•â•â•â• TYPE CONFIGS â•â•â•â•â•â•â• */
const TYPES = {
  indexing:{
    label:'INDEXING', tc:'t-indexing', bc:'bg-indexing', dc:'d-indexing',
    hint:'ì–´ë–¤ <strong>ì˜ˆì‹œ/ì„¸ë¶€ ë‚´ìš©</strong>ì„ ê¸€ì˜ ì£¼ì œë¡œ ì°©ê°í–ˆë‚˜ìš”?',
    fields:[
      {key:'example', label:'ì°©ê°í•œ ì˜ˆì‹œ ë‚´ìš©',     ph:'e.g. a specific experimental result'},
      {key:'mainIdea',label:'ì‹¤ì œ ì£¼ì œ/ì¤‘ì‹¬ ë‚´ìš©',   ph:'e.g. limitations of the scientific method'},
      {key:'passage', label:'ê´€ë ¨ ë³¸ë¬¸ ë¬¸ì¥ (ì„ íƒ)',ph:'For instance...'},
    ],
    build(f){return{
      question:`ë‹¤ìŒ ë‚´ìš©ì€ ê¸€ì˜ <em>ì£¼ì œ</em>ì¸ê°€, ë‹¨ìˆœ <em>ì˜ˆì‹œ/ì„¸ë¶€ ë‚´ìš©</em>ì¸ê°€?\n\n"${f.example}"`,
      answer:'ì˜ˆì‹œÂ·ì„¸ë¶€ ë‚´ìš© (ì£¼ì œ ì•„ë‹˜)',
      explanation:`ì‹¤ì œ ì£¼ì œ: "${f.mainIdea}"\n\nì´ ë‚´ìš©ì€ ì£¼ì œë¥¼ ë’·ë°›ì¹¨í•˜ëŠ” êµ¬ì²´ì  ì˜ˆì‹œì…ë‹ˆë‹¤.`,
      action:'í–‰ë™ê°•ë ¹: ì˜ˆì‹œ ë‚˜ì˜¤ë©´ â†’ "ì´ê±´ ì˜ˆì‹œì•¼, ì£¼ì œëŠ” ë” ìœ„ì— ìˆì–´" ë¼ê³  ìŠ¤ìŠ¤ë¡œ ë§í•˜ê¸°'
    };}
  },
  targeting:{
    label:'TARGETING', tc:'t-targeting', bc:'bg-targeting', dc:'d-targeting',
    hint:'ì§ˆë¬¸ í‚¤ì›Œë“œê°€ ë³¸ë¬¸ì— ì—†ì„ ë•Œ ì–´ë–¤ <strong>ìƒìœ„ê°œë…Â·ë™ì˜ì–´</strong>ë¡œ ì°¾ì•„ì•¼ í–ˆë‚˜ìš”?',
    fields:[
      {key:'qKeyword', label:'ì§ˆë¬¸ì˜ í‚¤ì›Œë“œ (ì§€ë¬¸ì— ì—†ëŠ”)', ph:'e.g. Producers'},
      {key:'textWord', label:'ë³¸ë¬¸ì˜ ëŒ€ì‘ í‘œí˜„',             ph:'e.g. Record companies'},
      {key:'relation', label:'ë‘ í‘œí˜„ì˜ ê´€ê³„',               ph:'e.g. Producers = hypernym of Record companies'},
    ],
    build(f){return{
      question:`ì§ˆë¬¸ì˜ í‚¤ì›Œë“œ <em>${f.qKeyword}</em>ê°€ ì§€ë¬¸ì— ì—†ì„ ë•Œ,\në³¸ë¬¸ì—ì„œ ì°¾ì•„ì•¼ í•  í‘œí˜„ì€?`,
      answer:f.textWord,
      explanation:`ê´€ê³„: ${f.relation}\n\nì§ˆë¬¸ì–´ â‰  ë³¸ë¬¸ í‘œí˜„ â†’ ìƒìœ„ê°œë…Â·í•˜ìœ„ì˜ˆì‹œÂ·ë™ì˜ì–´ë¡œ ì¬íƒ€ê²ŸíŒ….`,
      action:'í–‰ë™ê°•ë ¹: í‚¤ì›Œë“œê°€ ì•ˆ ë³´ì´ë©´ â†’ "ë” ë„“ì€ ê°œë… or êµ¬ì²´ ì˜ˆì‹œëŠ”?" ìœ¼ë¡œ ì¬ìŠ¤ìº”'
    };}
  },
  paraphrase:{
    label:'PARAPHRASE', tc:'t-paraphrase', bc:'bg-paraphrase', dc:'d-paraphrase',
    hint:'ë³¸ë¬¸ í‘œí˜„ê³¼ ì„ ì§€ í‘œí˜„ì´ <strong>ê°™ì€ ì˜ë¯¸</strong>ì¸ë° ì—°ê²° ëª» í–ˆë‚˜ìš”?',
    fields:[
      {key:'passageExpr',label:'ë³¸ë¬¸ í‘œí˜„',              ph:'e.g. soothe, inspire'},
      {key:'choiceExpr', label:'ì„ ì§€ í‘œí˜„ (ê°™ì€ ì˜ë¯¸)',  ph:'e.g. effects on the listener'},
      {key:'context',    label:'ì™œ ê°™ì€ ì˜ë¯¸ì¸ì§€ ì„¤ëª…', ph:'e.g. calming/inspiring listeners = effect on them'},
    ],
    build(f){return{
      question:`ë³¸ë¬¸ì˜ í‘œí˜„ <em>${f.passageExpr}</em>ê³¼\nê°™ì€ ì˜ë¯¸ì˜ ì„ ì§€ í‘œí˜„ì€?`,
      answer:f.choiceExpr,
      explanation:`ì—°ê²° ë…¼ë¦¬: ${f.context}\n\nì„ ì§€ëŠ” ë³¸ë¬¸ì„ ì§ì ‘ ì“°ì§€ ì•Šê³  ì˜ë¯¸ ì••ì¶•Â·ë°”ê¾¸ê¸°ë¥¼ í•©ë‹ˆë‹¤.`,
      action:'í–‰ë™ê°•ë ¹: ì„ ì§€ ë‹¨ì–´ë¥¼ ë³¸ë¬¸ì—ì„œ ëª» ì°¾ê² ìœ¼ë©´ â†’ "ì˜ë¯¸ê°€ ê°™ì€ ë‹¤ë¥¸ í‘œí˜„ì€?" ìœ¼ë¡œ ì¬í•´ì„'
    };}
  },
  logic:{
    label:'LOGIC', tc:'t-logic', bc:'bg-logic', dc:'d-logic',
    hint:'<strong>ê·¹ë‹¨ì–´(always/every)</strong>ë‚˜ <strong>ìˆ˜ëŸ‰Â·ëŒ€ìƒ ë¹„êµ ë…¼ë¦¬</strong>ë¥¼ ì˜ëª» í•´ì„í–ˆë‚˜ìš”?',
    fields:[
      {key:'choiceText',   label:'ì˜¤ë‹µ ì„ ì§€ ë¬¸ì¥',          ph:'e.g. All music always soothes listeners.'},
      {key:'trapWord',     label:'í•¨ì •ì´ ëœ ë‹¨ì–´ or ë…¼ë¦¬',  ph:'e.g. All, always â†’ passage only says "some"'},
      {key:'correctLogic', label:'ë³¸ë¬¸ì˜ ì‹¤ì œ ë²”ìœ„/ë…¼ë¦¬',   ph:'e.g. some music may influence listeners'},
    ],
    build(f){return{
      question:`ë‹¤ìŒ ì„ ì§€ê°€ ì˜¤ë‹µì¸ ì´ìœ ë¥¼ ì„¤ëª…í•˜ì‹œì˜¤:\n\n<strong>"${f.choiceText}"</strong>`,
      answer:`í•¨ì •: "${f.trapWord}"`,
      explanation:`ë³¸ë¬¸ì˜ ì‹¤ì œ ë²”ìœ„: "${f.correctLogic}"\n\nì„ ì§€ê°€ ë³¸ë¬¸ë³´ë‹¤ ê³¼ì¥Â·ì¶•ì†ŒÂ·ì™œê³¡ëœ ê²½ìš° ì˜¤ë‹µ.`,
      action:'í–‰ë™ê°•ë ¹: always/every/only/never ë³´ì´ë©´ â†’ ë³¸ë¬¸ì—ì„œ í•´ë‹¹ ë²”ìœ„ ì¦‰ì‹œ ê²€ì¦'
    };}
  }
};

/* â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â• */
let quizzes   = loadQ();
let curStep   = 'indexing';
let queue     = [], qIdx = 0;
let isFlipped = false, chosenIdx = null, lastCorrect = null;
let streak    = loadSt();
let curFilter = 'all';

/* â•â•â•â•â•â•â• data.json LOADER â•â•â•â•â•â•â• */
async function loadDataJson(manual=false) {
  const el  = document.getElementById('dataStatus');
  const el2 = document.getElementById('dataStatus2');
  if(el) { el.className='data-status loading'; el.textContent='â³ data.json ë¡œë”© ì¤‘...'; }
  try {
    const res = await fetch('./data.json?t='+Date.now());
    if (!res.ok) throw new Error(res.status);
    const arr = await res.json();
    const existIds = new Set(quizzes.map(q=>q.id));
    let added=0;
    arr.forEach(item=>{
      if(existIds.has(item.id)) return;
      const e=JSON.parse(JSON.stringify(item));
      if(e.nextReview==='TODAY') e.nextReview=todayStr();
      if(!e.history)   e.history=[];
      if(e.cycleIdx==null) e.cycleIdx=0;
      quizzes.push(e); added++;
    });
    if(added>0) saveQ(quizzes);
    const msg=`âœ“ data.json ë¡œë“œ ì™„ë£Œ â€” ${arr.length}ê°œ (ì‹ ê·œ ${added}ê°œ)`;
    if(el)  { el.className='data-status ok';  el.textContent=msg; }
    if(el2) el2.textContent=msg;
    if(manual) showToast('â†º ì¬ë¡œë“œ ì™„ë£Œ: '+added+'ê°œ ì‹ ê·œ ì¶”ê°€','ok');
  } catch(e) {
    const msg='âš  data.json ì—†ìŒ â€” localStorageë§Œ ì‚¬ìš©';
    if(el)  { el.className='data-status err'; el.textContent=msg; }
    if(el2) el2.textContent=msg;
  }
  renderToday();
  renderBrowse();
}

/* â•â•â•â•â•â•â• TAB SWITCH â•â•â•â•â•â•â• */
function switchTab(t) {
  document.querySelectorAll('.tab').forEach(el=>el.classList.toggle('active',el.dataset.tab===t));
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById('sec-'+t).classList.add('active');
  if(t==='today')    renderToday();
  if(t==='browse')   renderBrowse();
  if(t==='add')      renderForm();
  if(t==='settings') renderSettings();
}

function showToast(msg, type='') {
  const el=document.getElementById('toast');
  el.textContent=msg; el.className=`toast show ${type}`;
  clearTimeout(el._t); el._t=setTimeout(()=>el.className='toast',2500);
}

/* â•â•â•â•â•â•â• TODAY â•â•â•â•â•â•â• */
function renderToday() {
  const due   = quizzes.filter(q=>isDue(q)&&q.nextReview!=='9999-12-31');
  const total = quizzes.filter(q=>q.nextReview!=='9999-12-31').length;
  document.getElementById('statTotal').textContent   = total;
  document.getElementById('statDue').textContent     = due.length;
  document.getElementById('statStreak').textContent  = streak.count;
  document.getElementById('streakBadge').textContent = `ğŸ”¥ ${streak.count} ì—°ì†`;
  const badge=document.getElementById('badge-today');
  badge.textContent=due.length; badge.classList.toggle('show',due.length>0);
  const btn=document.getElementById('startBtn');
  btn.disabled=due.length===0;
  btn.textContent=due.length>0?`â–¶ ë³µìŠµ ì‹œì‘ (${due.length}ê°œ)`:'ì˜¤ëŠ˜ ë³µìŠµ ì™„ë£Œ! âœ“';
  const listEl=document.getElementById('todayList');
  if(!due.length){
    listEl.innerHTML=`<div class="today-empty"><div class="ei">ğŸ‰</div><p>ì˜¤ëŠ˜ ë³µìŠµí•  í€´ì¦ˆê°€ ì—†ì–´ìš”!<br><strong>ì¶”ê°€</strong> íƒ­ì—ì„œ ìƒˆ ì˜¤ë‹µì„ ë“±ë¡í•˜ë©´<br>ë§ê°ê³¡ì„ ì— ë§ì¶° ìë™ ë³µìŠµ ì˜ˆì•½ë¼ìš”.</p></div>`;
    return;
  }
  listEl.innerHTML=due.map(q=>{
    const t=TYPES[q.type];
    const cl=q.cycleIdx<IVLS.length?`+${IVLS[q.cycleIdx]}ì¼`:'ì™„ë£Œ';
    const mcqTag=q.isMCQ?` <span style="font-size:9px;color:var(--purple);font-family:var(--mono);">[MCQ]</span>`:'';
    return `<div class="quiz-row" onclick="startSingle(${quizzes.indexOf(q)})">
      <div class="qr-dot ${t.dc}"></div>
      <div class="qr-info">
        <div class="qr-type ${t.tc}">${t.label}${mcqTag}</div>
        <div class="qr-q">${q.quiz.question.replace(/<[^>]+>/g,'').substring(0,48)}...</div>
      </div>
      <span class="qr-cycle">${cl}</span>
      <span style="color:var(--text3);font-size:14px;flex-shrink:0;">â€º</span>
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â• BROWSE â•â•â•â•â•â•â• */
function setFilter(f, btn) {
  curFilter=f;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderBrowse();
}

function renderBrowse() {
  let list = quizzes;
  if(curFilter==='mcq')   list=quizzes.filter(q=>q.isMCQ);
  else if(curFilter==='due') list=quizzes.filter(q=>isDue(q)&&q.nextReview!=='9999-12-31');
  else if(curFilter!=='all') list=quizzes.filter(q=>q.type===curFilter);

  const el=document.getElementById('browseList');
  if(!list.length){
    el.innerHTML=`<div class="today-empty"><div class="ei">ğŸ”</div><p>í•´ë‹¹ ì¡°ê±´ì˜ í€´ì¦ˆê°€ ì—†ì–´ìš”.</p></div>`;
    return;
  }
  el.innerHTML=list.map(q=>{
    const i=quizzes.indexOf(q);
    const t=TYPES[q.type];
    const src=q.source?`<span class="tag tag-src">${q.source}</span>`:'';
    const mcq=q.isMCQ?`<span class="tag tag-mcq">MCQ</span>`:'';
    const done=q.nextReview==='9999-12-31'?`<span class="tag tag-done">ì™„ë£Œ</span>`:'';
    const rate=q.history.length?Math.round(q.history.filter(Boolean).length/q.history.length*100)+'%':'-';
    const nextR=q.nextReview==='9999-12-31'?'ì™„ë£Œ':q.nextReview;
    return `<div class="aqi">
      <div class="aqi-dot ${t.dc}" style="margin-top:5px;"></div>
      <div class="aqi-info" onclick="openDetail(${i})" style="cursor:pointer;">
        <div class="aqi-type">${src}${mcq}${done}<span class="${t.tc}">${t.label}</span></div>
        <div class="aqi-q">${q.quiz.question.replace(/<[^>]+>/g,'').substring(0,55)}...</div>
        <div class="aqi-meta">ë³µìŠµ: ${nextR} Â· ì •ë‹µë¥  ${rate} Â· ${q.history.length}íšŒ</div>
      </div>
      <div class="aqi-actions">
        <button class="aqi-reset" onclick="resetOneQuiz(${i})">â†º ì´ˆê¸°í™”</button>
        <button class="aqi-del"   onclick="delQuiz(${i})">ì‚­ì œ</button>
      </div>
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â• DETAIL MODAL â•â•â•â•â•â•â• */
function openDetail(i) {
  const q=quizzes[i];
  if(!q) return;
  const t=TYPES[q.type];
  const opts=q.isMCQ ? `
    <div class="detail-section">
      <div class="detail-label">ì„ ì§€</div>
      ${q.quiz.options.map((o,idx)=>`
        <div style="display:flex;gap:8px;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--border);">
          <span style="font-family:var(--mono);font-size:12px;color:${idx===q.quiz.correctIdx?'var(--mint)':'var(--text3)'};">${'â‘ â‘¡â‘¢â‘£'[idx]}</span>
          <span style="font-size:13px;color:${idx===q.quiz.correctIdx?'var(--mint)':'var(--text2)'};">${o}</span>
        </div>`).join('')}
    </div>` : '';

  document.getElementById('detailContent').innerHTML=`
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;">
      <span class="fc-badge ${t.bc} ${t.tc}" style="margin:0;">${t.label}${q.isMCQ?' Â· MCQ':''}</span>
      ${q.source?`<span class="tag tag-src">${q.source}</span>`:''}
    </div>
    <div class="detail-section">
      <div class="detail-label">ì§ˆë¬¸</div>
      <div class="detail-content">${q.quiz.question.replace(/\n/g,'<br>')}</div>
    </div>
    ${opts}
    <div class="detail-section">
      <div class="detail-label">ì •ë‹µ</div>
      <div class="detail-ans">${q.quiz.answer}</div>
    </div>
    <div class="detail-section">
      <div class="detail-label">í•´ì„¤</div>
      <div class="detail-exp">${q.quiz.explanation.replace(/\n/g,'<br>')}</div>
    </div>
    <div class="detail-section">
      <div class="detail-action-box">${q.quiz.action}</div>
    </div>
    <div style="font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:8px;">
      ì •ë‹µë¥ : ${q.history.length?Math.round(q.history.filter(Boolean).length/q.history.length*100)+'%':'-'} Â· 
      ${q.history.length}íšŒ í’€ì´ Â· 
      ë‹¤ìŒ ë³µìŠµ: ${q.nextReview==='9999-12-31'?'ì™„ë£Œ':q.nextReview}
    </div>`;

  document.getElementById('detailModal').classList.add('open');
}
function closeDetail(e) {
  if(e.target===document.getElementById('detailModal')) closeDetailSheet();
}
function closeDetailSheet() {
  document.getElementById('detailModal').classList.remove('open');
}

/* â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â• */
function renderSettings() {
  const total=quizzes.length;
  const done=quizzes.filter(q=>q.nextReview==='9999-12-31').length;
  document.getElementById('s2statTotal').textContent  = total;
  document.getElementById('s2statStreak').textContent = streak.best||streak.count||0;
  document.getElementById('s2statDone').textContent   = done;
}

/* ê°œë³„ í€´ì¦ˆ ì´ˆê¸°í™” */
function resetOneQuiz(i) {
  quizzes[i].cycleIdx  = 0;
  quizzes[i].nextReview= todayStr();
  quizzes[i].history   = [];
  saveQ(quizzes);
  renderBrowse(); renderToday();
  showToast('â†º í•´ë‹¹ í€´ì¦ˆ ì´ˆê¸°í™” ì™„ë£Œ','ok');
}

/* ì „ì²´ ë³µìŠµ ì´ˆê¸°í™” (ë°ì´í„°ëŠ” ìœ ì§€, ì§„í–‰ë§Œ ë¦¬ì…‹) */
function resetAllProgress() {
  if(!confirm('ëª¨ë“  í€´ì¦ˆì˜ ë³µìŠµ ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?\n(í€´ì¦ˆ ë‚´ìš©ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)')) return;
  quizzes.forEach(q=>{ q.cycleIdx=0; q.nextReview=todayStr(); q.history=[]; });
  saveQ(quizzes);
  renderToday(); renderSettings(); renderBrowse();
  showToast('ğŸ”„ ì „ì²´ ë³µìŠµ ì´ˆê¸°í™” ì™„ë£Œ','ok');
}

/* ì—°ì† ê¸°ë¡ ì´ˆê¸°í™” */
function resetStreakOnly() {
  if(!confirm('ì—°ì† ì •ë‹µ ê¸°ë¡ì„ 0ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  streak={count:0,best:0,lastDate:''};
  saveSt(streak);
  document.getElementById('statStreak').textContent  = 0;
  document.getElementById('streakBadge').textContent = 'ğŸ”¥ 0 ì—°ì†';
  renderSettings();
  showToast('ğŸ”¥ ì—°ì† ê¸°ë¡ ì´ˆê¸°í™”','ok');
}

/* ì „ì²´ ë°ì´í„° ì‚­ì œ */
function resetAllData() {
  if(!confirm('âš ï¸ ëª¨ë“  í€´ì¦ˆì™€ ê¸°ë¡ì„ ì‚­ì œí•©ë‹ˆë‹¤.\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ì–´ìš”. ê³„ì†í• ê¹Œìš”?')) return;
  if(!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ì–´ìš”?')) return;
  quizzes=[]; saveQ(quizzes);
  streak={count:0,best:0,lastDate:''}; saveSt(streak);
  renderToday(); renderSettings(); renderBrowse();
  showToast('ğŸ—‘ ì „ì²´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ');
}

/* â•â•â•â•â•â•â• ADD FORM â•â•â•â•â•â•â• */
function selectStep(el,step) {
  document.querySelectorAll('.step-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected'); curStep=step; renderForm();
}
function renderForm() {
  const t=TYPES[curStep];
  document.getElementById('hintBox').innerHTML=t.hint;
  document.getElementById('formFields').innerHTML=t.fields.map(f=>
    `<div class="form-grp"><label class="form-lbl">${f.label}</label>
     <input type="text" id="f_${f.key}" placeholder="${f.ph}" oninput="updatePreview()"></div>`
  ).join('');
  updatePreview();
}
function getVals() {
  const v={};
  TYPES[curStep].fields.forEach(f=>{const el=document.getElementById('f_'+f.key);v[f.key]=el?el.value.trim():'';});
  return v;
}
function updatePreview() {
  const v=getVals(), t=TYPES[curStep];
  const ok=t.fields.filter(f=>!f.label.includes('ì„ íƒ')).every(f=>v[f.key]);
  if(!ok){document.getElementById('previewBox').innerHTML=`<span style="color:var(--text3)">í•„ë“œë¥¼ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</span>`;return;}
  try{
    const q=t.build(v);
    document.getElementById('previewBox').innerHTML=`
      <div style="font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--text3);margin-bottom:8px;text-transform:uppercase;">ì§ˆë¬¸</div>
      <div style="font-size:13px;color:var(--text);line-height:1.8;margin-bottom:12px;">${q.question.replace(/\n/g,'<br>')}</div>
      <div style="font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--text3);margin-bottom:5px;text-transform:uppercase;">ì •ë‹µ</div>
      <div style="font-size:14px;color:var(--mint);font-weight:700;">${q.answer}</div>`;
  }catch{document.getElementById('previewBox').innerHTML=`<span style="color:var(--text3)">ë¯¸ë¦¬ë³´ê¸° ì˜¤ë¥˜</span>`;}
}
function addQuiz() {
  const v=getVals(), t=TYPES[curStep];
  if(t.fields.filter(f=>!f.label.includes('ì„ íƒ')).some(f=>!v[f.key])){showToast('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!','ng');return;}
  quizzes.push({id:'u_'+Date.now(),type:curStep,isMCQ:false,quiz:t.build(v),fields:v,source:'ì§ì ‘ ì…ë ¥',createdAt:todayStr(),nextReview:addDays(todayStr(),1),cycleIdx:0,history:[]});
  saveQ(quizzes);
  TYPES[curStep].fields.forEach(f=>{const el=document.getElementById('f_'+f.key);if(el)el.value='';});
  updatePreview(); renderToday();
  showToast('âœ“ ì €ì¥ ì™„ë£Œ! 1ì¼ í›„ ë³µìŠµ ì˜ˆì •','ok');
}

function delQuiz(i) {
  if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
  quizzes.splice(i,1); saveQ(quizzes); renderBrowse(); renderToday();
  showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

/* â•â•â•â•â•â•â• SESSION â•â•â•â•â•â•â• */
function startQuiz() {
  queue=quizzes.map((q,i)=>({...q,_idx:i}))
    .filter(q=>isDue(q)&&q.nextReview!=='9999-12-31')
    .sort(()=>Math.random()-.5);
  if(!queue.length) return;
  qIdx=0; openQuiz();
}
function startSingle(idx) {
  queue=[{...quizzes[idx],_idx:idx}]; qIdx=0; openQuiz();
}
function openQuiz()  { document.getElementById('quiz-overlay').classList.add('open'); loadCard(); }
function closeQuiz() { document.getElementById('quiz-overlay').classList.remove('open'); resetCardUI(); renderToday(); }

function resetCardUI() {
  document.getElementById('fcCard').classList.remove('flipped');
  document.getElementById('oxWrap').classList.remove('show');
  document.getElementById('btnConfirm').classList.remove('show');
  document.getElementById('btnNext').classList.remove('show');
  document.getElementById('mcqOpts').innerHTML='';
  document.getElementById('fcTap').classList.remove('hidden');
  isFlipped=false; chosenIdx=null; lastCorrect=null;
}

function loadCard() {
  if(qIdx>=queue.length){ closeQuiz(); showToast(`ğŸ‰ ì„¸ì…˜ ì™„ë£Œ! ${queue.length}ê°œ`,'ok'); return; }
  resetCardUI();
  const q=queue[qIdx], t=TYPES[q.type];
  document.getElementById('qoCurrent').textContent = qIdx+1;
  document.getElementById('qoTotal').textContent   = queue.length;
  document.getElementById('qoFill').style.width    = (qIdx/queue.length*100)+'%';
  document.getElementById('qoSrc').textContent     = q.source||'';
  const badge=document.getElementById('fcBadge');
  badge.className  =`fc-badge ${t.bc} ${t.tc}`;
  badge.textContent= t.label+(q.isMCQ?' Â· MCQ':'');
  document.getElementById('fcQ').innerHTML      = q.quiz.question.replace(/\n/g,'<br>');
  document.getElementById('fcAns').textContent  = q.quiz.answer;
  document.getElementById('fcExp').innerHTML    = q.quiz.explanation.replace(/\n/g,'<br>');
  document.getElementById('fcAction').textContent = q.quiz.action;
  if(q.isMCQ) {
    document.getElementById('fcTap').classList.add('hidden');
    document.getElementById('mcqOpts').innerHTML=q.quiz.options.map((opt,i)=>
      `<button class="mcq-opt" id="mo_${i}" onclick="chooseMcq(${i})">
        <span class="mcq-num">${'â‘ â‘¡â‘¢â‘£'[i]}</span><span>${opt}</span>
      </button>`).join('');
    document.getElementById('fcFront').onclick=null;
  } else {
    document.getElementById('fcFront').onclick=flipToBack;
  }
}

function flipToBack() {
  if(isFlipped) return;
  isFlipped=true;
  document.getElementById('fcCard').classList.add('flipped');
  setTimeout(()=>document.getElementById('oxWrap').classList.add('show'),300);
}

function chooseMcq(idx) {
  if(isFlipped) return;
  chosenIdx=idx;
  document.querySelectorAll('.mcq-opt').forEach((el,i)=>el.classList.toggle('selected',i===idx));
  document.getElementById('btnConfirm').classList.add('show');
}

function confirmMcq() {
  if(chosenIdx===null||isFlipped) return;
  isFlipped=true;
  const q=queue[qIdx];
  lastCorrect=(chosenIdx===q.quiz.correctIdx);
  document.querySelectorAll('.mcq-opt').forEach((el,i)=>{
    el.classList.remove('selected');
    if(i===q.quiz.correctIdx) el.classList.add('correct');
    else if(i===chosenIdx&&!lastCorrect) el.classList.add('wrong');
  });
  document.getElementById('btnConfirm').classList.remove('show');
  recordResult(lastCorrect);
  setTimeout(()=>{
    document.getElementById('fcCard').classList.add('flipped');
    setTimeout(()=>document.getElementById('btnNext').classList.add('show'),400);
  },600);
}

function recordResult(correct) {
  const q=queue[qIdx], ri=q._idx;
  if(correct){
    const td=todayStr();
    if(streak.lastDate===td)               streak.count++;
    else if(streak.lastDate===addDays(td,-1)){streak.count++;streak.lastDate=td;}
    else{streak.count=1;streak.lastDate=td;}
    streak.best=Math.max(streak.best||0,streak.count);
    saveSt(streak);
    document.getElementById('statStreak').textContent  = streak.count;
    document.getElementById('streakBadge').textContent = `ğŸ”¥ ${streak.count} ì—°ì†`;
  }
  quizzes[ri].history.push(correct);
  advanceSRS(quizzes[ri],correct);
  saveQ(quizzes);
  showToast(correct?'â­• ì •ë‹µ!':'âŒ ì˜¤ë‹µ â€” 1ì¼ í›„ ì¬ë³µìŠµ', correct?'ok':'ng');
}

function goNext(correct) {
  const q=queue[qIdx];
  if(!q.isMCQ && correct!==undefined) recordResult(correct);
  document.getElementById('qoFill').style.width=((qIdx+1)/queue.length*100)+'%';
  qIdx++;
  setTimeout(()=>{ resetCardUI(); setTimeout(loadCard,150); },280);
}

/* â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â• */
renderToday();
renderForm();
loadDataJson();
</script>
</body>
</html>
